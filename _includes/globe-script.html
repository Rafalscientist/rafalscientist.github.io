<script>
  (function() {
    function init() {
      const elem = document.getElementById('globeViz');
      // Bezpiecznik: jeśli nie ma kontenera lub biblioteka jeszcze się nie wczytała, poczekaj
      if (!elem || typeof Globe !== 'function') {
        setTimeout(init, 400);
        return;
      }

      // Twoje dane - precyzyjne współrzędne
      const myData = [
        { city: "Münster (Germany)", lat: 51.96, lng: 7.62, events: [{ name: "NOEKS 15", id: "noeks-15", nr: "15" }] },
        { city: "Kraków (Poland)", lat: 50.06, lng: 19.94, events: [{ name: "Konferencja Fizyki", id: "krakow-2024", nr: "12" }] },
        { city: "Warszawa (Poland)", lat: 52.22, lng: 21.01, events: [{ name: "Theory Day", id: "warsaw-2021", nr: "3" }] }
      ];

      const world = Globe()(elem)
        .globeImageUrl('unpkg.com')
        .backgroundColor('rgba(0,0,0,0)')
        .showAtmosphere(true)
        .pointsData(myData)
        .pointColor(() => '#ffffff')
        .pointRadius(0.8)
        .pointLabel(d => {
          const links = d.events.map(e => `<span style="color:#888;">[${e.nr}]</span> ${e.name}`).join('<br/>');
          return `<div style="background:rgba(0,0,0,0.85);padding:10px;border:1px solid #444;color:white;font-family:sans-serif;"><b>${d.city}</b><br/>${links}</div>`;
        })
        .pointOfView({ lat: 52, lng: 19, altitude: 2.5 }, 0);

      world.controls().enableZoom = false;

      // Dopasowanie rozmiaru do Twojego czarnego prostokąta
      const resize = () => {
        world.width(elem.offsetWidth);
        world.height(500);
      };
      resize();
      window.addEventListener('resize', resize);
    }

    if (document.readyState === 'complete') init();
    else window.addEventListener('load', init);
  })();
</script>
