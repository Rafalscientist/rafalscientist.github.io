<!-- 1. Biblioteka silnika 3D -->
<script src="cdn.jsdelivr.net"></script>

<script>
  // Zamknięcie w funkcji, aby nie zepsuć reszty strony (tzw. IIFE)
  (function() {
    function init() {
      const elem = document.getElementById('globeViz');
      if (!elem) {
        console.log("Czekam na kontener #globeViz...");
        setTimeout(init, 500); // Ponów jeśli szablon jeszcze go nie wyrenderował
        return;
      }

      // Twoje dane wejściowe
      const myData = [
        { city: "Münster", lat: 51.96, lng: 7.62, events: [{ name: "NOEKS 15", id: "noeks-15", nr: "15" }] },
        { city: "Kraków", lat: 50.06, lng: 19.94, events: [{ name: "Konferencja", id: "krakow-2024", nr: "12" }] },
        { city: "Warszawa", lat: 52.22, lng: 21.01, events: [{ name: "Theory Day", id: "warsaw-2021", nr: "3" }] }
      ];

      try {
        const world = Globe()(elem)
          .globeImageUrl('unpkg.com')
          .backgroundColor('rgba(0,0,0,0)')
          .showAtmosphere(true)
          .pointsData(myData)
          .pointColor(() => '#ffffff')
          .pointRadius(0.8)
          .pointLabel(d => `<div style="background:black;padding:8px;border:1px solid #444;color:white;font-family:sans-serif;">${d.city}</div>`)
          .pointOfView({ lat: 52, lng: 19, altitude: 2 });

        world.controls().enableZoom = false;

        // Dopasowanie do czarnego prostokąta
        world.width(elem.offsetWidth);
        world.height(elem.offsetHeight);

        console.log("Globus zainicjowany pomyślnie.");
      } catch (e) {
        console.log("Błąd inicjalizacji globusa:", e);
      }
    }

    // Uruchom po załadowaniu całej strony
    if (document.readyState === 'complete') {
      init();
    } else {
      window.addEventListener('load', init);
    }
  })();
</script>
